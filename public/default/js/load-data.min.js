var searchScroll,hadsearchScroll,goodsScroll,storeScroll,miso=window.miso||{};miso.setData=function(b){this.data=b};miso.getData=function(){return this.data};
(function(b){b.fn.tab=function(a){var c=b.extend({num:1,contents:".contents"},a||{});this.each(function(){var a=b(this).children("[data-role=tab]");b(".hashchangeCache:visible").find("[data-role=content]");a.eq(c.num).addClass("choose").siblings().removeClass("choose");b(".hashchangeCache:visible").find("[data-role=content]").eq(c.num).removeClass("ku_thide").siblings().addClass("ku_thide");a.bind({click:function(){var a=b(this),c=a.index();a.addClass("choose").siblings(".choose").removeClass("choose");
b(".hashchangeCache:visible").find("[data-role=content]").eq(c).removeClass("ku_thide").siblings().addClass("ku_thide");goodsScroll.refresh();storeScroll.refresh()}})})}})(jQuery);$("#store_tabs").tab();$("#goods_tabs").tab();searchScroll=new iScroll("ajax_search",{checkDOMChanges:!0});hadsearchScroll=new iScroll("ajax_hadsearch",{checkDOMChanges:!0});goodsScroll=new iScroll("js_goods_index_wrapper",{checkDOMChanges:!0});storeScroll=new iScroll("js_store_index_wrapper",{checkDOMChanges:!0});
var cache={"":$(".bbq-default")};
$(window).bind("hashchange",function(b){var a=$.param.fragment(),c;0<a.indexOf("&")?(c=a.split("&")[0].split("/")[1],a.split("&")[0].split("/")):(c=a.split("/")[1],a.split("/"));$(".ajax_box .hashchangeCache").hide();$("#hot_keywords .hashchangeCache").show();$(".ajax_box").not($("#ajax_"+c)).hide();$("#ajax_search_box").show();c||($("#ajax_search").show(),$("#ajax_hadsearch").hide(),searchScroll.refresh());cache[a]?($("#ajax_search").hide(),$("#ajax_hadsearch").show(),void 0==c?($("#ajax_search").show(),
$("#ajax_hadsearch").hide()):(cache[a].closest("#ajax_"+c).show(),cache[a].show(),searchScroll.refresh(),hadsearchScroll.refresh(),storeScroll.refresh(),goodsScroll.refresh())):("none"==$(".box_welcome").css("display")&&$("#ajax_"+c).find(".mod_loading").show(),$.ajax({url:a,complete:function(){cache[a]=miso.getData();searchScroll.refresh();hadsearchScroll.refresh();storeScroll.refresh();goodsScroll.refresh()},success:function(a){miso.hashCallback.call(this,c,a);$(".box_welcome").fadeOut();$("#ajax_"+
c).find(".mod_loading").fadeOut()}}),$("#ajax_"+c).fadeIn())});$(window).trigger("hashchange");$(".js_back").click(function(){history.back()});$(".mod_searchBox .search .toSearch").click(function(){var b=$(this);$(".mod_searchBox .search .inputBox input").blur();var a=$(".mod_searchBox .search .inputBox input").val();a?b.attr("href","#index.php?r=default/hadsearch/index&keyword="+a):alert("\u8bf7\u8f93\u5165\u641c\u7d22\u5173\u952e\u5b57")});
$("#hot_keywords").delegate("a","click",function(){var b=$(this),a=b.text();$("#index_search_box").val(a);b.attr("href","#index.php?r=default/hadsearch/index&keyword="+a)});$(".clearInput").click(function(){$("#index_search_box").val("")});miso.hashCallback=function(b,a){switch(b){case "hadsearch":showSearch(a);break;case "goods":showGoods(a);break;case "store":showStore(a)}};
function showSearch(b){var a=eval("("+b+")");b=a.code;if(1==b){b=a.data.goods;var a=a.data.store,c=baidu.template,d="",e;for(e in b)d+=c("search:goods",b[e]);for(var f in a)d+=c("search:store",a[f]);e=$('<div class="hashchangeCache" />').appendTo("#listOut").html(d);miso.setData(e)}else 0==b&&$(".mod_nodata").show();$("#ajax_search").hide();$("#ajax_hadsearch").show()}
function showGoods(b){b=eval("("+b+")");var a=b.code;if(1==a){b=b.data.goods;a=baidu.template;a.ESCAPE=!1;var c="",c=a("goods:detail",b);b=$('<div class="hashchangeCache" />').appendTo("#ajax_goods_data").html(c);miso.setData(b);$("#goods_tabs").tab({num:1})}else 0==a&&alert("\u4eb2\uff0c\u60a8\u8bbf\u95ee\u7684\u5730\u5740\u4e0d\u5b58\u5728")}
function showStore(b){b=eval("("+b+")");var a=b.code;if(1==a){a=baidu.template;a.ESCAPE=!1;var c="",c=a("store:detail",b.data);b=$('<div class="hashchangeCache" />').appendTo("#ajax_store_data").html(c);miso.setData(b);$("#store_tabs").tab({num:1})}else 0==a&&alert("\u4eb2\uff0c\u60a8\u8bbf\u95ee\u7684\u5730\u5740\u4e0d\u5b58\u5728")}function clearCache(b){b=$(b).find(".hashchangeCache");3<=b.length&&(b.remove(),miso.setData(null))};
